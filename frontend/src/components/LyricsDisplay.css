
/* ===== NEW PWA-STYLE CHORD DISPLAY ===== */
.lyrics-content .pwa-style .chord-lyric-line {
  position: relative;
  display: block;
  padding: 0;
  margin: 0;
  line-height: var(--line-height);
  font-size: var(--lyric-font-size);
  color: #374151;
  font-weight: 500;
}

.lyrics-content .pwa-style .chord-lyric-line.empty-line {
  line-height: 1.4em;
  height: 1.4em;
  min-height: 1.4em;
}

.lyrics-content .pwa-style .chord-lyric-line.text-only {
  line-height: var(--line-height);
}

/* ===== GROUP 1: BASIC PWA CHORD STYLING (CURRENTLY ACTIVE) ===== */
.lyrics-content .pwa-style .pwa-chord-inline {
  position: absolute;
  display: inline-block;
  margin-top: -1.5em;
  z-index: 2;
  pointer-events: none;
}

.lyrics-content .pwa-style .pwa-chord-inline i {
  display: inline-block;
  margin-left: 0;
  width: 0;
  color: transparent;
  font-style: normal;
}

.lyrics-content .pwa-style .pwa-chord {
  display: inline-block;
  margin-right: 5px;
  color: var(--chord-color);
  font-weight: 600;
  cursor: pointer;
  font-size: var(--chord-font-size);
  min-width: fit-content; /* Ensure chord takes needed space */
}

.lyrics-content .pwa-style .pwa-chord span {
  background-color: var(--chord-bg); /* Move background to span */
  border: 1px solid var(--chord-border); /* Move border to span */
  padding: var(--chord-padding, 2px 6px); /* Dynamic padding based on font size */
  border-radius: 4px; /* Move border radius to span */
  display: inline;
}

.lyrics-content .pwa-style .pwa-chord:hover {
  text-decoration: underline;
  opacity: 1; /* Remove opacity change */
}

.lyrics-content .pwa-style .pwa-lyric {
  display: inline-block;
  white-space: pre-wrap;
  color: #374151;
  font-weight: 500;
  position: relative;
  z-index: 1;
  line-height: inherit;
  min-width: 0; /* Allow shrinking when needed */
}

/* Ensure proper spacing for consecutive chords */
.lyrics-content .pwa-style .pwa-lyric:empty {
  min-width: 0; /* Remove min-width for empty spans to avoid text disruption */
  display: inline-block;
}

/* ===== GROUP 2: CONSECUTIVE CHORD SPACING ===== */
/* Add spacing between consecutive chord spans - BACKUP method */
.lyrics-content .pwa-style .pwa-lyric:has(.pwa-chord-inline) + .pwa-lyric:has(.pwa-chord-inline) {
  margin-left: 8px; /* Add margin between consecutive chord containers - fallback only */
}

/* Fallback for browsers that don't support :has() */
.lyrics-content .pwa-style .pwa-lyric[style*="position: relative"] + .pwa-lyric[style*="position: relative"] {
  margin-left: 8px;
}

/* Very specific selector for consecutive chords - ensure uniform spacing */
/* FIXED: Add proper spacing for consecutive chords instead of removing it */
div.pwa-style div.chord-lyric-line span.pwa-lyric.consecutive-chord {
  margin-left: 8px !important; /* Add spacing between consecutive chords */
  display: inline-block !important; /* Ensure proper inline-block behavior */
  min-width: 1ch !important; /* Ensure minimum width to hold the chord */
  min-height: 1em !important; /* Ensure minimum height matches line */
  vertical-align: baseline !important; /* Align with text baseline */
}

/* New inline chord styling - match regular chord style */
.pwa-inline-chord {
  color: var(--chord-color, #dc2626) !important;
  font-weight: 600 !important;
  background-color: var(--chord-bg) !important;
  border: 1px solid var(--chord-border) !important;
  padding: var(--chord-padding, 2px 6px) !important;
  border-radius: 4px !important;
  font-size: var(--chord-font-size) !important;
  display: inline !important;
}

.pwa-inline-chord span {
  color: var(--chord-color, #dc2626) !important;
  font-weight: 600 !important;
}

/* Special handling for chords at end of line with no character */
.lyrics-content .pwa-style .pwa-lyric:has(.pwa-chord-inline):empty::after {
  content: '\00A0'; /* Add a non-breaking space for chords at end */
  display: inline;
  width: 0;
  visibility: hidden;
}

/* Ensure text continuity */
.lyrics-content .pwa-style .pwa-lyric {
  display: inline-block;
  white-space: pre-wrap; /* Preserve original text spacing */
  color: #374151;
  font-weight: 500;
  position: relative;
  z-index: 1;
  line-height: inherit;
  vertical-align: baseline; /* Ensure consistent baseline alignment */
}

/* Special styling for inline chord lines (from backticks) */
.lyrics-content .pwa-style .chord-lyric-line .pwa-lyric {
  white-space: nowrap; /* Prevent breaking of chord sequences */
}

/* Add natural word spacing for chord-lyric lines */
.lyrics-content .pwa-style .chord-lyric-line {
  word-spacing: normal;
  white-space: pre-wrap;
}

/* Ensure proper spacing between elements */
.lyrics-content .pwa-style .chord-lyric-line .pwa-lyric {
  display: inline;
  white-space: pre-wrap;
}

/* ===== BACKWARD COMPATIBILITY STYLES ===== */
/* Keep existing styles for other display modes */

/* Inline Chords Container */
.lyrics-content .lyric-container {
  line-height: var(--line-height);
  /* Flexbox with iOS compatibility */
  display: -webkit-box;      /* iOS < 7 */
  display: -webkit-flex;     /* iOS 7-8 */
  display: -ms-flexbox;      /* IE 10 */
  display: flex;             /* Modern browsers */
  
  /* Flex-wrap with fallbacks for iOS */
  -webkit-flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  flex-wrap: wrap;
  
  /* Additional iOS fixes */
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
  
  /* Prevent iOS Safari from collapsing */
  min-height: 1px;
  width: 100%;
}

/* Inline Chords Container */
.lyrics-content .inline-chord-container {
  margin-bottom: 1.5rem;
}

.lyrics-content .lyric-text-with-inline-chords {
  /* iOS compatible flexbox */
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  
  -webkit-box-align: center;
  -webkit-align-items: center;
  -ms-flex-align: center;
  align-items: center;
  
  -webkit-flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  flex-wrap: wrap;
  
  gap: 0.5rem;
  
  /* iOS Safari specific fixes */
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
}

.lyrics-content .lyric-text-part {
  color: #374151;
  font-weight: 500;
  line-height: 1.4;
}

.lyrics-content .inline-chords-part {
  /* iOS compatible flexbox */
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  
  -webkit-box-align: center;
  -webkit-align-items: center;
  -ms-flex-align: center;
  align-items: center;
  
  gap: 0.5rem;
  
  -webkit-flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  flex-wrap: wrap;
  
  /* iOS Safari specific fixes */
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
}

.lyrics-content .inline-chord {
  font-weight: bold;
  line-height: 1;
  white-space: nowrap;
  display: inline-block;
  /* Use same styling as regular chord labels */
  color: var(--chord-color);
  background-color: var(--chord-bg);
  border: 1px solid var(--chord-border);
  font-size: var(--chord-font-size);
  padding: var(--chord-padding, 2px 6px);
  border-radius: 4px;
}

/* Legacy styles for backward compatibility */
.lyrics-content .inline-chords-line {
  /* iOS compatible flexbox */
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  
  -webkit-box-pack: center;
  -webkit-justify-content: center;
  -ms-flex-pack: center;
  justify-content: center;
  
  -webkit-box-align: center;
  -webkit-align-items: center;
  -ms-flex-align: center;
  align-items: center;
  
  gap: 1rem;
  margin-bottom: 0.5rem;
  min-height: 24px;
  
  /* iOS Safari specific fixes */
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
}

.lyrics-content .lyric-text {
  text-align: center;
  color: #374151;
  font-weight: 500;
  line-height: 1.4;
}

.lyrics-content .chord-segment {
  position: relative;
  display: inline-block;
  margin-right: 0.25rem;
  white-space: nowrap;
  vertical-align: baseline;
}

.lyrics-content .chord-label {
  position: absolute;
  left: 0;
  top: var(--chord-top);
  font-weight: bold;
  white-space: nowrap;
  padding: var(--chord-padding, 2px 6px);
  border-radius: 4px;
  font-size: var(--chord-font-size);
  color: var(--chord-color);
  background-color: var(--chord-bg);
  border: 1px solid var(--chord-border);
  min-width: max-content;
  line-height: 1;
  z-index: 1;
}

.lyrics-content .lyric-word {
  font-size: var(--lyric-font-size);
  color: #374151;
  font-weight: 500;
  display: inline-block;
  line-height: var(--lyric-font-size);
  vertical-align: baseline;
  padding-top: var(--text-padding-top);
}

.lyrics-content .lyric-word-no-chord {
  font-size: var(--lyric-font-size);
  color: #374151;
  font-weight: 500;
  display: inline-block;
  margin-right: 0.25rem;
  padding-top: var(--text-padding-top);
}

.lyrics-content .lyric-text-segment {
  font-size: var(--lyric-font-size);
  color: #374151;
  font-weight: 500;
  display: inline-block;
  white-space: pre-wrap; /* Preserve spaces and line breaks */
  vertical-align: baseline;
  line-height: var(--lyric-font-size);
  padding-top: var(--text-padding-top);
}

/* Spaced layout for chords that are too close together */
.lyrics-content .spaced-lyric-container {
  margin-bottom: 1rem;
  display: block;
}

.lyrics-content .chord-text-pairs {
  /* iOS compatible flexbox */
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  
  -webkit-box-align: start;
  -webkit-align-items: flex-start;
  -ms-flex-align: start;
  align-items: flex-start;
  
  -webkit-flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  flex-wrap: wrap;
  
  gap: 0.5rem;
  
  /* iOS Safari specific fixes */
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
  -webkit-flex-direction: row;
  -ms-flex-direction: row;
  flex-direction: row;
}

.lyrics-content .chord-text-pair {
  /* iOS compatible flexbox */
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  
  -webkit-box-align: start;
  -webkit-align-items: flex-start;
  -ms-flex-align: start;
  align-items: flex-start;
  
  margin-right: 0.5rem;
}

.lyrics-content .chord-above {
  margin-bottom: 2px;
  height: calc(var(--chord-font-size) + 8px);
  /* iOS compatible flexbox */
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  
  -webkit-box-align: end;
  -webkit-align-items: flex-end;
  -ms-flex-align: end;
  align-items: flex-end;
}

.lyrics-content .text-below {
  /* iOS compatible flexbox */
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  
  -webkit-box-align: start;
  -webkit-align-items: flex-start;
  -ms-flex-align: start;
  align-items: flex-start;
}

.lyrics-content .chord-row {
  /* iOS compatible flexbox */
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  
  -webkit-box-align: end;
  -webkit-align-items: flex-end;
  -ms-flex-align: end;
  align-items: flex-end;
  
  margin-bottom: 2px;
  height: calc(var(--chord-font-size) + 8px);
}

.lyrics-content .text-row {
  /* iOS compatible flexbox */
  display: -webkit-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: flex;
  
  -webkit-box-align: start;
  -webkit-align-items: flex-start;
  -ms-flex-align: start;
  align-items: flex-start;
}

.lyrics-content .chord-item {
  /* iOS compatible flexbox */
  display: -webkit-inline-box;
  display: -webkit-inline-flex;
  display: -ms-inline-flexbox;
  display: inline-flex;
  
  -webkit-box-align: center;
  -webkit-align-items: center;
  -ms-flex-align: center;
  align-items: center;
  
  -webkit-box-pack: center;
  -webkit-justify-content: center;
  -ms-flex-pack: center;
  justify-content: center;
  
  font-weight: bold;
  white-space: nowrap;
  font-size: var(--chord-font-size);
  color: var(--chord-color);
  background-color: var(--chord-bg);
  border: 1px solid var(--chord-border);
  padding: var(--chord-padding, 2px 6px);
  border-radius: 4px;
  min-width: 2rem;
  text-align: center;
  line-height: 1;
  height: calc(var(--chord-font-size) + 8px);
  box-sizing: border-box;
}

.lyrics-content .chord-spacer {
  display: inline-block;
  min-width: 0.5rem;
  height: calc(var(--chord-font-size) + 8px);
  visibility: hidden;
}

.lyrics-content .text-segment {
  display: inline-block;
  font-size: var(--lyric-font-size);
  color: #374151;
  font-weight: 500;
  white-space: pre-wrap;
  min-width: 1rem;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
  .lyrics-content .chord-segment {
    margin-right: 0.2rem;
  }
  
  .lyrics-content .chord-label {
    padding: var(--chord-padding, 1px 4px);
    font-size: calc(var(--chord-font-size) * 0.9);
  }
  
  .lyrics-content .lyric-word,
  .lyrics-content .lyric-word-no-chord {
    font-size: calc(var(--lyric-font-size) * 0.95);
  }

  /* PWA mobile styles */
  .lyrics-content .pwa-style .chord-lyric-line {
    line-height: var(--line-height); /* Use dynamic line-height */
  }
  
  .lyrics-content .pwa-style .chord-lyric-line.text-only {
    line-height: var(--line-height); /* Use dynamic line-height */
  }
  
  .lyrics-content .pwa-style .pwa-chord-inline {
    margin-top: -1.2em; /* Adjust for smaller line-height */
  }
  
  .lyrics-content .pwa-style .pwa-chord {
    margin-right: 4px; /* Slightly reduce margin on mobile */
    font-size: calc(var(--chord-font-size) * 0.9); /* Reduce chord font size on mobile */
  }

  /* Inline chords mobile styles with iOS fixes */
  .lyrics-content .lyric-text-with-inline-chords {
    gap: 0.25rem;
    /* Fallback for iOS without gap support */
    margin-right: -0.25rem;
  }
  
  .lyrics-content .lyric-text-with-inline-chords > * {
    margin-right: 0.25rem;
  }
  
  .lyrics-content .inline-chords-part {
    gap: 0.25rem;
    /* Fallback for iOS without gap support */
    margin-right: -0.25rem;
  }
  
  .lyrics-content .inline-chords-part > * {
    margin-right: 0.25rem;
  }
  
  .lyrics-content .inline-chord {
    font-size: calc(var(--chord-font-size) * 0.9);
    padding: var(--chord-padding, 1px 4px);
  }
  
  .lyrics-content .lyric-text-part {
    font-size: calc(var(--lyric-font-size) * 0.95);
  }

  /* Legacy mobile styles */
  .lyrics-content .inline-chords-line {
    gap: 0.5rem;
    -webkit-flex-wrap: wrap;
    -ms-flex-wrap: wrap;
    flex-wrap: wrap;
    /* Fallback for iOS without gap support */
    margin-right: -0.5rem;
  }
  
  .lyrics-content .inline-chords-line > * {
    margin-right: 0.5rem;
  }
  
  .lyrics-content .lyric-text {
    font-size: calc(var(--lyric-font-size) * 0.95);
  }

  /* Spaced layout mobile styles with iOS fixes */
  .lyrics-content .chord-text-pairs {
    gap: 0.25rem;
    /* Fallback for iOS without gap support */
    margin-right: -0.25rem;
  }
  
  .lyrics-content .chord-text-pairs > * {
    margin-right: 0.25rem;
  }
  
  .lyrics-content .chord-text-pair {
    margin-right: 0.25rem;
  }
  
  .lyrics-content .chord-item {
    font-size: calc(var(--chord-font-size) * 0.9);
    padding: var(--chord-padding, 1px 4px);
    min-width: 1.5rem;
    height: calc(var(--chord-font-size) * 0.9 + 8px);
    box-sizing: border-box;
  }
  
  .lyrics-content .text-segment {
    font-size: calc(var(--lyric-font-size) * 0.95);
  }
  
  .lyrics-content .chord-spacer {
    margin-right: 0.25rem;
    height: calc(var(--chord-font-size) * 0.9 + 8px);
  }
}

/* iOS specific fixes */
/* Target iOS Safari specifically */
@supports (-webkit-overflow-scrolling: touch) {
  .lyrics-content .lyric-container {
    /* Force hardware acceleration */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    
    /* Prevent iOS from "optimizing" the layout */
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    
    /* Fix for iOS text rendering */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  .lyrics-content .chord-segment {
    /* Fix positioning issues on iOS */
    position: relative;
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
  }
  
  .lyrics-content .chord-label {
    /* Ensure chord labels render properly */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    will-change: transform;
  }
}

/* Text Selection Support for PWA */
@media (display-mode: standalone) {
  /* Enable text selection for all lyric elements */
  .lyrics-content, .lyric-container, .lyric-text-with-inline-chords,
  .lyric-text, .chord-text, .inline-chord {
    -webkit-user-select: text !important;
    user-select: text !important;
    -webkit-touch-callout: default;
    touch-action: manipulation;
  }
  
  /* Ensure chord and lyric spans are selectable */
  .chord-above, .lyric-below, .word-container {
    -webkit-user-select: text !important;
    user-select: text !important;
  }
}

/* Additional iOS version specific fixes */
@media screen and (-webkit-min-device-pixel-ratio: 1) and (max-device-width: 768px) {
  /* iOS 7-8 specific fixes */
  .lyrics-content .lyric-container {
    /* Fallback to table layout for very old iOS */
    display: table;
    table-layout: fixed;
    width: 100%;
  }
  
  @supports (display: flex) {
    .lyrics-content .lyric-container {
      display: -webkit-flex;
      display: flex;
      -webkit-flex-wrap: wrap;
      flex-wrap: wrap;
    }
  }
}

/* ===== COLUMN LAYOUT FOR DESKTOP/LANDSCAPE ===== */
.lyrics-content.column-layout {
  column-count: 2;
  column-gap: 3rem;
  column-fill: balance;
  column-rule: 1px solid #e5e7eb;
  padding: 0 1rem;
  position: relative;
}

/* Visual indicator for column mode */
.lyrics-content.column-layout::before {
  content: "";
  position: absolute;
  top: -0.5rem;
  left: 50%;
  transform: translateX(-50%);
  width: 2rem;
  height: 2px;
  background: linear-gradient(to right, #3b82f6, #10b981);
  border-radius: 1px;
  opacity: 0.6;
}

/* Prevent breaking inside chord lines */
.lyrics-content.column-layout .chord-lyric-line {
  break-inside: avoid;
  page-break-inside: avoid;
}

/* Prevent breaking inside verse blocks */
.lyrics-content.column-layout .verse-block {
  break-inside: avoid;
  page-break-inside: avoid;
  margin-bottom: 1.5rem;
}

/* Adjust spacing for column layout */
.lyrics-content.column-layout .chord-lyric-line {
  margin-bottom: 0.5rem;
}

.lyrics-content.column-layout .chord-lyric-line.empty-line {
  margin-bottom: 0.75rem;
}

/* Responsive column behavior */
@media (max-width: 1023px) {
  .lyrics-content.column-layout {
    column-count: 1;
    column-rule: none;
    padding: 0;
  }
  
  .lyrics-content.column-layout::before {
    display: none;
  }
}

/* Fine-tune for very wide screens */
@media (min-width: 1400px) {
  .lyrics-content.column-layout {
    column-gap: 4rem;
  }
}

/* Prevent orphan chords at column breaks */
.lyrics-content.column-layout .pwa-chord-inline {
  break-inside: avoid;
}
